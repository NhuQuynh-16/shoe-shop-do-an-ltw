@{
    ViewBag.Title = "Giỏ hàng";
    Layout = "~/Views/Shared/_Layout_TrangChinh.cshtml";
}
@using System.Linq
@model List<Website_Giay.Models.CartItem>

<div class="container my-4">
    <h2 class="text-center mb-4">Giỏ hàng của bạn</h2>

    @if (Model == null || !Model.Any())
    {
        <div class="alert alert-info text-center">
            <p>Giỏ hàng đang trống.</p>
            @Html.ActionLink("Tiếp tục mua sắm", "Index", "Home", null, new { @class = "btn btn-primary" })
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th>Sản phẩm</th>
                        <th>Ảnh</th>
                        <th>Size</th>
                        <th>Giá</th>
                        <th>Số lượng</th>
                        <th>Tổng</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.ProductName</td>
                            <td>
                                <div style="width: 80px; height: 80px; display: flex; align-items: center; justify-content: center;">
                                    <img src="~/Content/images/@item.Image" 
                                         style="max-width: 100%; max-height: 100%;"
                                         alt="@item.ProductName" />
                                </div>
                            </td>
                            <td>
                                @using (Html.BeginForm("CapNhatSize", "GioHang", FormMethod.Post))
                                {
                                    <input type="hidden" name="maSP" value="@item.ProductId" />
                                    <select name="size" class="form-control" style="width: 80px;" onchange="this.form.submit()">
                                        @foreach (var size in new[] { "35", "36", "37", "38", "39", "40", "41", "42", "43", "44" })
                                        {
                                            <option value="@size" @(item.Size == size ? "selected" : "")>@size</option>
                                        }
                                    </select>
                                }
                            </td>
                            <td class="text-right">@item.Price.ToString("N0") đ</td>
                            <td>
                                @using (Html.BeginForm("CapNhatSoLuong", "GioHang", FormMethod.Post))
                                {
                                    <input type="hidden" name="maSP" value="@item.ProductId" />
                                    <div class="input-group" style="max-width: 150px;">
                                        <input type="number" name="soLuong" class="form-control text-center" 
                                               value="@item.Quantity" min="1" onchange="this.form.submit()" />
                                    </div>
                                }
                            </td>
                            <td class="text-right">
                                @((item.Price * item.Quantity).ToString("N0")) đ
                            </td>
                            <td class="text-center">
                                @Html.ActionLink("Xóa", "XoaKhoiGio", new { maSP = item.ProductId }, new { @class = "btn btn-danger btn-sm" })
                            </td>
                        </tr>
                    }
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="5" class="text-right"><strong>Tổng cộng:</strong></td>
                        <td class="text-right">
                            <strong>@Model.Sum(i => i.Price * i.Quantity).ToString("N0") đ</strong>
                        </td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="row mt-4">
            <div class="col-md-6">
                @Html.ActionLink("Tiếp tục mua sắm", "Index", "Home", null, new { @class = "btn btn-primary" })
                @Html.ActionLink("Xóa giỏ hàng", "XoaGioHang", null, new { @class = "btn btn-danger" })
            </div>
            <div class="col-md-6 text-right">
                @if (Session["User"] == null)
                {
                    <button type="button" class="btn btn-success btn-lg" onclick="window.location.href='@Url.Action("DangNhap", "TaiKhoan", new { returnUrl = "/DatHang/Checkout" })'">
                        Tiến hành đặt hàng
                    </button>
                }
                else
                {
                    @Html.ActionLink("Tiến hành đặt hàng", "Checkout", "DatHang", null, new { @class = "btn btn-success btn-lg" })
                }
            </div>
        </div>
    }
</div>
